################################################################################
#
# Copyright 2005  Hon Hai Precision Ind. Co. Ltd.
#  All Rights Reserved.
# No portions of this material shall be reproduced in any form without the
# written permission of Hon Hai Precision Ind. Co. Ltd.
#
# All information contained in this document is Hon Hai Precision Ind.
# Co. Ltd. company private, proprietary, and trade secret property and
# are protected by international intellectual property laws and treaties.
#
# $Id$
#
# include $(ACOSTOPDIR)/config.mk 

#
#	linux 2.6 have som dir problem	
#
ACOSNAT_LINUX_VERSION=linux26
#ARCH=arm64
ifeq ($(LINUXDIR),$(BUILD_DIR)/kernel/linux-4.1)
KERNELPATH := $(BUILD_DIR)/kernel/linux-4.1
ACOSNAT := $(USERAPPS_DIR)/ap/acos/acos_nat
SRCBASE := $(BUILD_DIR)/bcmdrivers/broadcom/net/wl/impl51/main/src
else
KERNELPATH := $(BASEDIR)/components/opensource/linux/linux-2.6.36
ACOSNAT := $(KERNELPATH)/../../../../ap/acos/acos_nat
endif
ACOSNATSRC := nat/src

include $(ACOSNAT)/../config.mk 



EXTRA_CFLAGS += -D__LINUX__ -D__KERNEL__ -DMODULE \
    -Wall -DUSE_NF_HOOK \
    -fsigned-char \
	-DINCLUDE_ACOS_AGNAT -DAG_Firewall \
	-DAG_PORT_TRIGGER -DAG_MSN_ALG -UNAT_DEBUG \
	-DAG_MEETING_ALG -DAG_ICQ_ALG -UAG_YMSG_ALG -UAG_AIM_ALG \
	-DAG_SIP_ALG -DAG_URL_FILTER -DAG_DOS \
	-UAG_IKE_ALG -DAG_PPTP_ALG -DAG_L2TP_ALG \
	-DAG_TIME_SCHEDULE -DAG_EMAIL_LOG \
	-DAG_PROC_STATS_BPA \
	-D__CONE__ -D_BYTE_ORDER=_LITTLE_ENDIAN\
	-DAG_QOS \
	-DBANDWIDTH_DETECT \
	-DAG_SC_ALG \
	-DINCLUDE_L7_FILTER \
	-DINCLUDE_CLAMP_MSS \
	-UUSE_VMALLOC \
	-DINCLUDE_UPNP_SSDP_WORKAROUND \
	-DDROP_INCORRECT_CHKSUM \
	-DACOSNAT_FAST_PATH \
	-DIOCTL_NO_POINTER \
	-I$(SRCBASE)/include \
	-I$(ACOSNAT) -I$(ACOSNAT)/nat/src -I$(ACOSNAT)/nat/include
	#-DBCMCTF \
	
	
ifeq ($(ACOSNAT_LINUX_VERSION), linux26)
EXTRA_CFLAGS += -DAG_LINUX_26 -Dlinux_2_6_22
endif
#ifeq ($(CONFIG_NAT_4096_SESSION),y)
#EXTRA_CFLAGS += -DCONFIG_NAT_4096_SESSION
#endif
# Add support for 65536 connections
#ifeq ($(CONFIG_NAT_65536_SESSION),y)
#EXTRA_CFLAGS += -DCONFIG_NAT_65536_SESSION
#endif

ifeq ($(CONFIG_NAT_80_PF),y)
EXTRA_CFLAGS += -DCONFIG_NAT_80_PF
endif

ifeq ($(CONFIG_TREND_IQOS),y)
EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
endif

ifeq ($(CONFIG_NF_CONNTRACK),y)
EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif

#EXTRA_CFLAGS += -DNO_NAT_CLI
EXTRA_CFLAGS += -DINCLUDE_WAN_LAN_SUBNET
ifeq ($(PROFILE),WNR2000v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
endif
ifeq ($(PROFILE),WNR3500L)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
ifeq ($(INCLUDE_IGMP), YES)
EXTRA_CFLAGS += -DIGMP_PROXY
endif
endif
ifeq ($(PROFILE),WNDR3400)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR3300v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
endif
ifeq ($(PROFILE),WNR3500Lv2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DECOSYSTEM_SUPPORT
endif
ifeq ($(PROFILE),WNDR3400v3)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR3600)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR3700v3)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR4500)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR4000AC)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
endif
ifeq ($(PROFILE),WNDR4500REV)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE #Foxcoon Perry added 2012/02/14
endif
ifeq ($(PROFILE),R7000)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DVIDEO_STREAMING_QOS
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DCONFIG_FBWIFI_DEBUG #Foxconn Perry added 11/25/2014
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
endif
ifeq ($(PROFILE),R7300)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
ifneq ($(CONFIG_TREND_IQOS),y)
EXTRA_CFLAGS += -DVIDEO_STREAMING_QOS
endif
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DCONFIG_FBWIFI_DEBUG #Foxconn Perry added 11/25/2014
EXTRA_CFLAGS += -DAPCONTROLLER
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
endif
ifeq ($(PROFILE),R8000)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif
ifeq ($(PROFILE),R7800)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif

ifeq ($(PROFILE),R8000P)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif
ifeq ($(PROFILE),AX6000)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif
ifeq ($(PROFILE),AX11000)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif
ifeq ($(PROFILE),R7900)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif

ifeq ($(PROFILE),R6400)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DVIDEO_STREAMING_QOS
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DCONFIG_FBWIFI_DEBUG #Foxconn Perry added 11/25/2014
endif
ifeq ($(PROFILE),R6700)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DVIDEO_STREAMING_QOS 
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
endif
ifeq ($(PROFILE),R6300v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
endif

ifeq ($(PROFILE),AC1450)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
endif

ifeq ($(PROFILE),R6250)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
endif
ifeq ($(PROFILE),R6200v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
endif
ifeq ($(PROFILE),R4500)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE #Foxcoon Perry added 2012/02/14
endif
ifeq ($(PROFILE),WNDR4500v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE #Foxcoon Perry added 2012/02/14
endif
ifeq ($(PROFILE),WNR3500v2)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
endif

ifeq ($(FXCN_CMS_SUPPORT),1)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
EXTRA_CFLAGS += -DNAT_JP_MULT_WAN
EXTRA_CFLAGS += -UNO_NAT_CLI
EXTRA_CFLAGS += -DWAN_USB_ACCESS -DSAMBA_ENABLE
EXTRA_CFLAGS += -DIGMP_PROXY
EXTRA_CFLAGS += -DNETFLIX_QOS_RULE
EXTRA_CFLAGS += -DCONFIG_KERNEL_2_6_36
#EXTRA_CFLAGS += -UFB_CAPTIVE_PORTAL
#EXTRA_CFLAGS += -DFB_CAPTIVE_PORTAL
EXTRA_CFLAGS += -DOPENVPN_SUPPORT
#EXTRA_CFLAGS += -DCONFIG_TREND_IQOS
#EXTRA_CFLAGS += -DCONFIG_NF_CONNTRACK
endif

ifeq ($(FW_TYPE),GR)
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
endif

ifeq ($(FW_TYPE),TWC)
EXTRA_CFLAGS += -DSUPPORT_ACOS_TR69C
endif
EXTRA_CFLAGS +=	-DNAT_PPTP_RUS

ifeq ($(PROFILE),MBR3500)
EXTRA_CFLAGS += -DHSDPA
endif

ifeq ($(PROFILE),MBRN3300H)
EXTRA_CFLAGS += -DHSDPA
EXTRA_CFLAGS += -DINCLUDE_TRAFFIC_METER
endif


# pling added 04/28/2009, USB spec 1.7, WAN FTP access to USB
ifeq ($(PROFILE),WNR3500U)
EXTRA_CFLAGS += -DWAN_USB_ACCESS
endif
ifeq ($(PROFILE),WNR3500L)
EXTRA_CFLAGS += -DWAN_USB_ACCESS
endif

ifeq ($(PROFILE),WNR3500L)
EXTRA_CFLAGS += -DINCLUDE_IPV6
else ifeq ($(PROFILE),MBRN3300H)
# NO IPV6
else
EXTRA_CFLAGS += -DINCLUDE_IPV6
endif

#add by dennis, foxconn, 01/11/2011, @cdless porting
EXTRA_CFLAGS += -DENABLE_CDLESS

#EXTRA_CFLAGS += -DINCLUDE_ACCESSCONTROL

EXTRA_CFLAGS +=  -Wno-date-time


#
#	needed in 2.4 logic
#
# foxconn wklin added start
# Silver
# ARCH=$(KERNEL_ARCH)
# CROSS_COMPILE=$(KERNEL_COMPILE)
# export ARCH CROSS_COMPILE
# foxconn wklin added end

acos_nat_lib-objs := $(ACOSNATSRC)/agNatWrapper.o $(ACOSNATSRC)/acosFw.o $(ACOSNATSRC)/acosFwNat.o \
	$(ACOSNATSRC)/packetfilter.o $(ACOSNATSRC)/agurlfilter.o $(ACOSNATSRC)/agvpnpass.o \
	$(ACOSNATSRC)/agnat.o $(ACOSNATSRC)/agipmanip.o $(ACOSNATSRC)/agruletbl.o $(ACOSNATSRC)/agutil.o \
	$(ACOSNATSRC)/agudpprocess.o $(ACOSNATSRC)/agtcpprocess.o $(ACOSNATSRC)/agicmpprocess.o \
	$(ACOSNATSRC)/agconntbl.o $(ACOSNATSRC)/agalgutil.o \
	$(ACOSNATSRC)/agftpalg.o $(ACOSNATSRC)/agicqalg.o $(ACOSNATSRC)/agikealg.o \
	$(ACOSNATSRC)/agipsecalg.o $(ACOSNATSRC)/agl2tpalg.o $(ACOSNATSRC)/agmeetingalg.o \
	$(ACOSNATSRC)/agmsnalg.o $(ACOSNATSRC)/agpptpalg.o $(ACOSNATSRC)/agrtspalg.o \
	$(ACOSNATSRC)/agsipalg.o $(ACOSNATSRC)/agYMSGalg.o $(ACOSNATSRC)/agaimalg.o \
	$(ACOSNATSRC)/agipfrag.o $(ACOSNATSRC)/agporttrigger.o $(ACOSNATSRC)/agdebug.o \
	$(ACOSNATSRC)/agdos.o $(ACOSNATSRC)/agUtilLib.o \
	$(ACOSNATSRC)/agCliFunc.o $(ACOSNATSRC)/agtimeschedule.o \
	$(ACOSNATSRC)/agLog_linux.o $(ACOSNATSRC)/dnsPktCheck.o $(ACOSNATSRC)/dnsPktCheckUtil.o \
	$(ACOSNATSRC)/agqos.o \
	$(ACOSNATSRC)/agnatproc.o \
	$(ACOSNATSRC)/agVersion.o \
	$(ACOSNATSRC)/agscalg.o \
	$(ACOSNATSRC)/fpath.o \
	$(ACOSNATSRC)/bcmctf.o \
	$(ACOSNATSRC)/fbcp_api.o \
	agNatHook.o 

ifeq ($(LINUXDIR),$(BUILD_DIR)/kernel/linux-4.1)
acos_nat_lib-objs += $(ACOSNATSRC)/fpath.o
endif
obj-m=acos_nat.o
acos_nat-objs = $(acos_nat_lib-objs) 


# INCS += -I.

# EXTRA_CFLAGS+=$(INCS) ${COPTS} -g
# ifeq ($(DEBUG_BUILD),1)
# EXTRA_CFLAGS+=-DDEBUG
# endif

CFLAGS_MODULE += $(EXTRA_CFLAGS)

# Foxconn Add : Steve Hsieh : @L26_porting , use Rules.make in 2.4
ifeq ($(ACOSNAT_LINUX_VERSION), linux24)
-include $(TOPDIR)/Rules.make
endif

ifeq ($(ACOSNAT_LINUX_VERSION), linux24)
all:
	echo build acos nat for $(ACOSNAT_LINUX_VERSION)
	$(MAKE)	-C ${KERNELPATH} SUBDIRS=$(shell pwd) modules ARCH=$(KERNEL_ARCH) CROSS_COMPILE=$(KERNEL_COMPILE)

install:
	$(STRIP) -S acos_nat.o
	install -d $(INSTALLDIR)/lib/modules
	install acos_nat.o $(INSTALLDIR)/lib/modules/acos_nat.o     

acos_nat.o : $(acos_nat-objs)
	$(LD) -o acos_nat.o -r $(acos_nat-objs)


else	

# 	linux 2.6 logic
ACOS_NAT_OBJS = $(acos_nat_lib-objs)

all: modules acos_nat_ksyms.c

modules:
	echo build acos nat for $(ACOSNAT_LINUX_VERSION)
	$(MAKE) -C ${KERNELPATH} M=$(shell pwd) modules

acos_nat_ksyms.c: acos_nat_ksyms.sh $(ACOS_NAT_OBJS) 
	touch -a $@
	sh -e $< $(ACOS_NAT_OBJS) > $@
	touch -f $@
	$(MAKE) -o acos_nat_ksyms.o

modules_install:
	@echo build acos_nat modules_install KERNELPATH = $(KERNELPATH)
	$(MAKE) -C ${KERNELPATH} M=$(shell pwd) modules_install

ifeq ($(LINUXDIR),$(BUILD_DIR)/kernel/linux-4.1)
install: 
	@echo build acos_nat installl KERNELPATH = $(KERNELPATH)
	$(STRIP) -S acos_nat.ko
	install -d $(TARGETDIR)/lib/modules/$(KERNELRELEASE)/extra
	install -m 755 acos_nat.ko  $(TARGETDIR)/lib/modules/$(KERNELRELEASE)/extra
	rm -rf $(TARGETDIR)/ap
else
install: modules_install
	@echo build acos_nat installl KERNELPATH = $(KERNELPATH)
	$(STRIP) -S acos_nat.ko
	install -d $(TARGETDIR)/lib/modules/2.6.36.4brcmarm+/kernel/lib
	install -m 755 acos_nat.ko  $(TARGETDIR)/lib/modules/2.6.36.4brcmarm+/kernel/lib
	rm -rf $(TARGETDIR)/ap
endif
endif

clean:
	-rm -rf Module.symvers .tmp_versions
	-rm -f *~ *.o *.ko *.mod.c acos_nat_ksyms.c
	-rm -f .version .*.o.flags .*.o.d .*.o.cmd .*.ko.cmd
	-find . -name '*.o' | xargs rm -f
	-find . -name '.*.o.flags' | xargs rm -f
	$(MAKE) -C ${KERNELPATH} M=$(shell pwd) clean
